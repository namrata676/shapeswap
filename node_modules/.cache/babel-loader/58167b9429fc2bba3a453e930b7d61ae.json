{"ast":null,"code":"import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';\nimport { merge } from 'lodash';\nimport { ProposalState, VotingStateLoadingStatus } from 'state/types';\nimport { getAllVotes, getProposal, getProposals, getVoteVerificationStatuses } from './helpers';\nconst initialState = {\n  proposalLoadingStatus: VotingStateLoadingStatus.INITIAL,\n  proposals: {},\n  voteLoadingStatus: VotingStateLoadingStatus.INITIAL,\n  votes: {}\n};\n\n// Thunks\nexport const fetchProposals = createAsyncThunk('voting/fetchProposals', async _ref => {\n  let {\n    first,\n    skip = 0,\n    state = ProposalState.ACTIVE\n  } = _ref;\n  const response = await getProposals(first, skip, state);\n  return response;\n});\nexport const fetchProposal = createAsyncThunk('voting/fetchProposal', async proposalId => {\n  const response = await getProposal(proposalId);\n  return response;\n});\nexport const fetchVotes = createAsyncThunk('voting/fetchVotes', async _ref2 => {\n  let {\n    proposalId,\n    block\n  } = _ref2;\n  const response = await getAllVotes(proposalId, block);\n  return {\n    votes: response,\n    proposalId\n  };\n});\nexport const verifyVotes = createAsyncThunk('voting/verifyVotes', async (_ref3, _ref4) => {\n  let {\n    proposalId,\n    snapshot\n  } = _ref3;\n  let {\n    getState\n  } = _ref4;\n  const state = getState();\n  const proposalVotes = state.voting.votes[proposalId];\n  const response = await getVoteVerificationStatuses(proposalVotes, Number(snapshot));\n  return {\n    results: response,\n    proposalId\n  };\n});\nexport const votingSlice = createSlice({\n  name: 'voting',\n  initialState,\n  reducers: {},\n  extraReducers: builder => {\n    // Verify Votes\n    builder.addCase(verifyVotes.fulfilled, (state, action) => {\n      const {\n        proposalId,\n        results\n      } = action.payload;\n      if (state.votes[proposalId]) {\n        state.votes[proposalId] = state.votes[proposalId].map(vote => {\n          return {\n            ...vote,\n            _inValid: results[vote.id] === false\n          };\n        });\n      }\n    });\n\n    // Fetch Proposals\n    builder.addCase(fetchProposals.pending, state => {\n      state.proposalLoadingStatus = VotingStateLoadingStatus.LOADING;\n    });\n    builder.addCase(fetchProposals.fulfilled, (state, action) => {\n      const proposals = action.payload.reduce((accum, proposal) => {\n        return {\n          ...accum,\n          [proposal.id]: proposal\n        };\n      }, {});\n      state.proposals = merge({}, state.proposals, proposals);\n      state.proposalLoadingStatus = VotingStateLoadingStatus.IDLE;\n    });\n\n    // Fetch Proposal\n    builder.addCase(fetchProposal.pending, state => {\n      state.proposalLoadingStatus = VotingStateLoadingStatus.LOADING;\n    });\n    builder.addCase(fetchProposal.fulfilled, (state, action) => {\n      state.proposals[action.payload.id] = action.payload;\n      state.proposalLoadingStatus = VotingStateLoadingStatus.IDLE;\n    });\n\n    // Fetch Votes\n    builder.addCase(fetchVotes.pending, state => {\n      state.voteLoadingStatus = VotingStateLoadingStatus.LOADING;\n    });\n    builder.addCase(fetchVotes.fulfilled, (state, action) => {\n      const {\n        votes,\n        proposalId\n      } = action.payload;\n      state.votes = {\n        ...state.votes,\n        [proposalId]: votes\n      };\n      state.voteLoadingStatus = VotingStateLoadingStatus.IDLE;\n    });\n  }\n});\nexport default votingSlice.reducer;","map":{"version":3,"names":["createAsyncThunk","createSlice","merge","ProposalState","VotingStateLoadingStatus","getAllVotes","getProposal","getProposals","getVoteVerificationStatuses","initialState","proposalLoadingStatus","INITIAL","proposals","voteLoadingStatus","votes","fetchProposals","first","skip","state","ACTIVE","response","fetchProposal","proposalId","fetchVotes","block","verifyVotes","snapshot","getState","proposalVotes","voting","Number","results","votingSlice","name","reducers","extraReducers","builder","addCase","fulfilled","action","payload","map","vote","_inValid","id","pending","LOADING","reduce","accum","proposal","IDLE","reducer"],"sources":["/Users/namratapatel/upwork/SmartFinance-OmniDex/src/state/voting/index.tsx"],"sourcesContent":["import { createAsyncThunk, createSlice } from '@reduxjs/toolkit'\nimport { merge } from 'lodash'\nimport { Proposal, ProposalState, VotingStateLoadingStatus, VotingState, Vote, State } from 'state/types'\nimport { getAllVotes, getProposal, getProposals, getVoteVerificationStatuses } from './helpers'\n\nconst initialState: VotingState = {\n  proposalLoadingStatus: VotingStateLoadingStatus.INITIAL,\n  proposals: {},\n  voteLoadingStatus: VotingStateLoadingStatus.INITIAL,\n  votes: {},\n}\n\n// Thunks\nexport const fetchProposals = createAsyncThunk<Proposal[], { first?: number; skip?: number; state?: ProposalState }>(\n  'voting/fetchProposals',\n  async ({ first, skip = 0, state = ProposalState.ACTIVE }) => {\n    const response = await getProposals(first, skip, state)\n    return response\n  },\n)\n\nexport const fetchProposal = createAsyncThunk<Proposal, string>('voting/fetchProposal', async (proposalId) => {\n  const response = await getProposal(proposalId)\n  return response\n})\n\nexport const fetchVotes = createAsyncThunk<\n  { votes: Vote[]; proposalId: string },\n  { proposalId: string; block?: number }\n>('voting/fetchVotes', async ({ proposalId, block }) => {\n  const response = await getAllVotes(proposalId, block)\n  return { votes: response, proposalId }\n})\n\nexport const verifyVotes = createAsyncThunk<\n  { results: { [key: string]: boolean }; proposalId: string },\n  { proposalId: string; snapshot?: string },\n  { state: State }\n>('voting/verifyVotes', async ({ proposalId, snapshot }, { getState }) => {\n  const state = getState()\n  const proposalVotes = state.voting.votes[proposalId]\n  const response = await getVoteVerificationStatuses(proposalVotes, Number(snapshot))\n  return { results: response, proposalId }\n})\n\nexport const votingSlice = createSlice({\n  name: 'voting',\n  initialState,\n  reducers: {},\n  extraReducers: (builder) => {\n    // Verify Votes\n    builder.addCase(verifyVotes.fulfilled, (state, action) => {\n      const { proposalId, results } = action.payload\n\n      if (state.votes[proposalId]) {\n        state.votes[proposalId] = state.votes[proposalId].map((vote) => {\n          return {\n            ...vote,\n            _inValid: results[vote.id] === false,\n          }\n        })\n      }\n    })\n\n    // Fetch Proposals\n    builder.addCase(fetchProposals.pending, (state) => {\n      state.proposalLoadingStatus = VotingStateLoadingStatus.LOADING\n    })\n    builder.addCase(fetchProposals.fulfilled, (state, action) => {\n      const proposals = action.payload.reduce((accum, proposal) => {\n        return {\n          ...accum,\n          [proposal.id]: proposal,\n        }\n      }, {})\n\n      state.proposals = merge({}, state.proposals, proposals)\n      state.proposalLoadingStatus = VotingStateLoadingStatus.IDLE\n    })\n\n    // Fetch Proposal\n    builder.addCase(fetchProposal.pending, (state) => {\n      state.proposalLoadingStatus = VotingStateLoadingStatus.LOADING\n    })\n    builder.addCase(fetchProposal.fulfilled, (state, action) => {\n      state.proposals[action.payload.id] = action.payload\n      state.proposalLoadingStatus = VotingStateLoadingStatus.IDLE\n    })\n\n    // Fetch Votes\n    builder.addCase(fetchVotes.pending, (state) => {\n      state.voteLoadingStatus = VotingStateLoadingStatus.LOADING\n    })\n    builder.addCase(fetchVotes.fulfilled, (state, action) => {\n      const { votes, proposalId } = action.payload\n\n      state.votes = {\n        ...state.votes,\n        [proposalId]: votes,\n      }\n      state.voteLoadingStatus = VotingStateLoadingStatus.IDLE\n    })\n  },\n})\n\nexport default votingSlice.reducer\n"],"mappings":"AAAA,SAASA,gBAAgB,EAAEC,WAAW,QAAQ,kBAAkB;AAChE,SAASC,KAAK,QAAQ,QAAQ;AAC9B,SAAmBC,aAAa,EAAEC,wBAAwB,QAAkC,aAAa;AACzG,SAASC,WAAW,EAAEC,WAAW,EAAEC,YAAY,EAAEC,2BAA2B,QAAQ,WAAW;AAE/F,MAAMC,YAAyB,GAAG;EAChCC,qBAAqB,EAAEN,wBAAwB,CAACO,OAAO;EACvDC,SAAS,EAAE,CAAC,CAAC;EACbC,iBAAiB,EAAET,wBAAwB,CAACO,OAAO;EACnDG,KAAK,EAAE,CAAC;AACV,CAAC;;AAED;AACA,OAAO,MAAMC,cAAc,GAAGf,gBAAgB,CAC5C,uBAAuB,EACvB,cAA6D;EAAA,IAAtD;IAAEgB,KAAK;IAAEC,IAAI,GAAG,CAAC;IAAEC,KAAK,GAAGf,aAAa,CAACgB;EAAO,CAAC;EACtD,MAAMC,QAAQ,GAAG,MAAMb,YAAY,CAACS,KAAK,EAAEC,IAAI,EAAEC,KAAK,CAAC;EACvD,OAAOE,QAAQ;AACjB,CAAC,CACF;AAED,OAAO,MAAMC,aAAa,GAAGrB,gBAAgB,CAAmB,sBAAsB,EAAE,MAAOsB,UAAU,IAAK;EAC5G,MAAMF,QAAQ,GAAG,MAAMd,WAAW,CAACgB,UAAU,CAAC;EAC9C,OAAOF,QAAQ;AACjB,CAAC,CAAC;AAEF,OAAO,MAAMG,UAAU,GAAGvB,gBAAgB,CAGxC,mBAAmB,EAAE,eAAiC;EAAA,IAA1B;IAAEsB,UAAU;IAAEE;EAAM,CAAC;EACjD,MAAMJ,QAAQ,GAAG,MAAMf,WAAW,CAACiB,UAAU,EAAEE,KAAK,CAAC;EACrD,OAAO;IAAEV,KAAK,EAAEM,QAAQ;IAAEE;EAAW,CAAC;AACxC,CAAC,CAAC;AAEF,OAAO,MAAMG,WAAW,GAAGzB,gBAAgB,CAIzC,oBAAoB,EAAE,wBAAkD;EAAA,IAA3C;IAAEsB,UAAU;IAAEI;EAAS,CAAC;EAAA,IAAE;IAAEC;EAAS,CAAC;EACnE,MAAMT,KAAK,GAAGS,QAAQ,EAAE;EACxB,MAAMC,aAAa,GAAGV,KAAK,CAACW,MAAM,CAACf,KAAK,CAACQ,UAAU,CAAC;EACpD,MAAMF,QAAQ,GAAG,MAAMZ,2BAA2B,CAACoB,aAAa,EAAEE,MAAM,CAACJ,QAAQ,CAAC,CAAC;EACnF,OAAO;IAAEK,OAAO,EAAEX,QAAQ;IAAEE;EAAW,CAAC;AAC1C,CAAC,CAAC;AAEF,OAAO,MAAMU,WAAW,GAAG/B,WAAW,CAAC;EACrCgC,IAAI,EAAE,QAAQ;EACdxB,YAAY;EACZyB,QAAQ,EAAE,CAAC,CAAC;EACZC,aAAa,EAAGC,OAAO,IAAK;IAC1B;IACAA,OAAO,CAACC,OAAO,CAACZ,WAAW,CAACa,SAAS,EAAE,CAACpB,KAAK,EAAEqB,MAAM,KAAK;MACxD,MAAM;QAAEjB,UAAU;QAAES;MAAQ,CAAC,GAAGQ,MAAM,CAACC,OAAO;MAE9C,IAAItB,KAAK,CAACJ,KAAK,CAACQ,UAAU,CAAC,EAAE;QAC3BJ,KAAK,CAACJ,KAAK,CAACQ,UAAU,CAAC,GAAGJ,KAAK,CAACJ,KAAK,CAACQ,UAAU,CAAC,CAACmB,GAAG,CAAEC,IAAI,IAAK;UAC9D,OAAO;YACL,GAAGA,IAAI;YACPC,QAAQ,EAAEZ,OAAO,CAACW,IAAI,CAACE,EAAE,CAAC,KAAK;UACjC,CAAC;QACH,CAAC,CAAC;MACJ;IACF,CAAC,CAAC;;IAEF;IACAR,OAAO,CAACC,OAAO,CAACtB,cAAc,CAAC8B,OAAO,EAAG3B,KAAK,IAAK;MACjDA,KAAK,CAACR,qBAAqB,GAAGN,wBAAwB,CAAC0C,OAAO;IAChE,CAAC,CAAC;IACFV,OAAO,CAACC,OAAO,CAACtB,cAAc,CAACuB,SAAS,EAAE,CAACpB,KAAK,EAAEqB,MAAM,KAAK;MAC3D,MAAM3B,SAAS,GAAG2B,MAAM,CAACC,OAAO,CAACO,MAAM,CAAC,CAACC,KAAK,EAAEC,QAAQ,KAAK;QAC3D,OAAO;UACL,GAAGD,KAAK;UACR,CAACC,QAAQ,CAACL,EAAE,GAAGK;QACjB,CAAC;MACH,CAAC,EAAE,CAAC,CAAC,CAAC;MAEN/B,KAAK,CAACN,SAAS,GAAGV,KAAK,CAAC,CAAC,CAAC,EAAEgB,KAAK,CAACN,SAAS,EAAEA,SAAS,CAAC;MACvDM,KAAK,CAACR,qBAAqB,GAAGN,wBAAwB,CAAC8C,IAAI;IAC7D,CAAC,CAAC;;IAEF;IACAd,OAAO,CAACC,OAAO,CAAChB,aAAa,CAACwB,OAAO,EAAG3B,KAAK,IAAK;MAChDA,KAAK,CAACR,qBAAqB,GAAGN,wBAAwB,CAAC0C,OAAO;IAChE,CAAC,CAAC;IACFV,OAAO,CAACC,OAAO,CAAChB,aAAa,CAACiB,SAAS,EAAE,CAACpB,KAAK,EAAEqB,MAAM,KAAK;MAC1DrB,KAAK,CAACN,SAAS,CAAC2B,MAAM,CAACC,OAAO,CAACI,EAAE,CAAC,GAAGL,MAAM,CAACC,OAAO;MACnDtB,KAAK,CAACR,qBAAqB,GAAGN,wBAAwB,CAAC8C,IAAI;IAC7D,CAAC,CAAC;;IAEF;IACAd,OAAO,CAACC,OAAO,CAACd,UAAU,CAACsB,OAAO,EAAG3B,KAAK,IAAK;MAC7CA,KAAK,CAACL,iBAAiB,GAAGT,wBAAwB,CAAC0C,OAAO;IAC5D,CAAC,CAAC;IACFV,OAAO,CAACC,OAAO,CAACd,UAAU,CAACe,SAAS,EAAE,CAACpB,KAAK,EAAEqB,MAAM,KAAK;MACvD,MAAM;QAAEzB,KAAK;QAAEQ;MAAW,CAAC,GAAGiB,MAAM,CAACC,OAAO;MAE5CtB,KAAK,CAACJ,KAAK,GAAG;QACZ,GAAGI,KAAK,CAACJ,KAAK;QACd,CAACQ,UAAU,GAAGR;MAChB,CAAC;MACDI,KAAK,CAACL,iBAAiB,GAAGT,wBAAwB,CAAC8C,IAAI;IACzD,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;AAEF,eAAelB,WAAW,CAACmB,OAAO"},"metadata":{},"sourceType":"module"}
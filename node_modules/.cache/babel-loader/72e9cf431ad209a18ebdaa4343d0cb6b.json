{"ast":null,"code":"/* eslint-disable no-continue *//* eslint-disable no-await-in-loop */import schema from'@uniswap/token-lists/src/tokenlist.schema.json';import Ajv from'ajv';import contenthashToUri from'./contenthashToUri';import{parseENSAddress}from'./ENS/parseENSAddress';import uriToHttp from'./uriToHttp';const tokenListValidator=new Ajv({allErrors:true}).compile(schema);/**\n * Contains the logic for resolving a list URL to a validated token list\n * @param listUrl list url\n * @param resolveENSContentHash resolves an ens name to a contenthash\n */export default async function getTokenList(listUrl,resolveENSContentHash){const parsedENS=parseENSAddress(listUrl);let urls;if(parsedENS){var _parsedENS$ensPath;let contentHashUri;try{contentHashUri=await resolveENSContentHash(parsedENS.ensName);}catch(error){console.error(\"Failed to resolve ENS name: \".concat(parsedENS.ensName),error);throw new Error(\"Failed to resolve ENS name: \".concat(parsedENS.ensName));}let translatedUri;try{translatedUri=contenthashToUri(contentHashUri);}catch(error){console.error('Failed to translate contenthash to URI',contentHashUri);throw new Error(\"Failed to translate contenthash to URI: \".concat(contentHashUri));}urls=uriToHttp(\"\".concat(translatedUri).concat((_parsedENS$ensPath=parsedENS.ensPath)!==null&&_parsedENS$ensPath!==void 0?_parsedENS$ensPath:''));}else{urls=uriToHttp(listUrl);}for(let i=0;i<urls.length;i++){const url=urls[i];const isLast=i===urls.length-1;let response;try{response=await fetch(url);}catch(error){console.error('Failed to fetch list',listUrl,error);if(isLast)throw new Error(\"Failed to download list \".concat(listUrl));continue;}if(!response.ok){if(isLast)throw new Error(\"Failed to download list \".concat(listUrl));continue;}const json=await response.json();if(!tokenListValidator(json)){var _tokenListValidator$e,_tokenListValidator$e2;const validationErrors=(_tokenListValidator$e=(_tokenListValidator$e2=tokenListValidator.errors)===null||_tokenListValidator$e2===void 0?void 0:_tokenListValidator$e2.reduce((memo,error)=>{const add=\"\".concat(error.dataPath,\" ?? ''}\");return memo.length>0?\"\".concat(memo,\"; \").concat(add):\"\".concat(add);},''))!==null&&_tokenListValidator$e!==void 0?_tokenListValidator$e:'unknown error';throw new Error(\"Token list failed validation: \".concat(validationErrors));}return json;}throw new Error('Unrecognized list URL protocol.');}","map":{"version":3,"names":["schema","Ajv","contenthashToUri","parseENSAddress","uriToHttp","tokenListValidator","allErrors","compile","getTokenList","listUrl","resolveENSContentHash","parsedENS","urls","_parsedENS$ensPath","contentHashUri","ensName","error","console","concat","Error","translatedUri","ensPath","i","length","url","isLast","response","fetch","ok","json","_tokenListValidator$e","_tokenListValidator$e2","validationErrors","errors","reduce","memo","add","dataPath"],"sources":["/Users/namratapatel/upwork/SmartFinance-OmniDex/src/utils/getTokenList.ts"],"sourcesContent":["/* eslint-disable no-continue */\n/* eslint-disable no-await-in-loop */\nimport { TokenList } from '@uniswap/token-lists'\nimport schema from '@uniswap/token-lists/src/tokenlist.schema.json'\nimport Ajv from 'ajv'\nimport contenthashToUri from './contenthashToUri'\nimport { parseENSAddress } from './ENS/parseENSAddress'\nimport uriToHttp from './uriToHttp'\n\nconst tokenListValidator = new Ajv({ allErrors: true }).compile(schema)\n\n/**\n * Contains the logic for resolving a list URL to a validated token list\n * @param listUrl list url\n * @param resolveENSContentHash resolves an ens name to a contenthash\n */\nexport default async function getTokenList(\n  listUrl: string,\n  resolveENSContentHash: (ensName: string) => Promise<string>,\n): Promise<TokenList> {\n  const parsedENS = parseENSAddress(listUrl)\n  let urls: string[]\n  if (parsedENS) {\n    let contentHashUri\n    try {\n      contentHashUri = await resolveENSContentHash(parsedENS.ensName)\n    } catch (error) {\n      console.error(`Failed to resolve ENS name: ${parsedENS.ensName}`, error)\n      throw new Error(`Failed to resolve ENS name: ${parsedENS.ensName}`)\n    }\n    let translatedUri\n    try {\n      translatedUri = contenthashToUri(contentHashUri)\n    } catch (error) {\n      console.error('Failed to translate contenthash to URI', contentHashUri)\n      throw new Error(`Failed to translate contenthash to URI: ${contentHashUri}`)\n    }\n    urls = uriToHttp(`${translatedUri}${parsedENS.ensPath ?? ''}`)\n  } else {\n    urls = uriToHttp(listUrl)\n  }\n  for (let i = 0; i < urls.length; i++) {\n    const url = urls[i]\n    const isLast = i === urls.length - 1\n    let response\n    try {\n      response = await fetch(url)\n    } catch (error) {\n      console.error('Failed to fetch list', listUrl, error)\n      if (isLast) throw new Error(`Failed to download list ${listUrl}`)\n      continue\n    }\n\n    if (!response.ok) {\n      if (isLast) throw new Error(`Failed to download list ${listUrl}`)\n      continue\n    }\n\n    const json = await response.json()\n    if (!tokenListValidator(json)) {\n      const validationErrors: string =\n        tokenListValidator.errors?.reduce<string>((memo, error) => {\n          const add = `${(error as any).dataPath} ?? ''}`\n          return memo.length > 0 ? `${memo}; ${add}` : `${add}`\n        }, '') ?? 'unknown error'\n      throw new Error(`Token list failed validation: ${validationErrors}`)\n    }\n    return json as TokenList\n  }\n  throw new Error('Unrecognized list URL protocol.')\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}
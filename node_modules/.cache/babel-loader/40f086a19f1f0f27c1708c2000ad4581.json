{"ast":null,"code":"/* eslint-disable no-param-reassign */\nimport { createAsyncThunk, createSlice } from '@reduxjs/toolkit';\nimport { LotteryStatus } from 'config/constants/types';\nimport { fetchLottery, fetchCurrentLotteryIdAndMaxBuy } from './helpers';\nimport getLotteriesData from './getLotteriesData';\nimport getUserLotteryData from './getUserLotteryData';\nconst initialState = {\n  currentLotteryId: null,\n  isTransitioning: false,\n  maxNumberTicketsPerBuyOrClaim: null,\n  currentRound: {\n    isLoading: true,\n    lotteryId: null,\n    status: LotteryStatus.PENDING,\n    startTime: '',\n    endTime: '',\n    priceTicketInCake: '',\n    discountDivisor: '',\n    treasuryFee: '',\n    firstTicketId: '',\n    lastTicketId: '',\n    amountCollectedInCake: '',\n    finalNumber: null,\n    cakePerBracket: [],\n    countWinnersPerBracket: [],\n    rewardsBreakdown: [],\n    userTickets: {\n      isLoading: true,\n      tickets: []\n    }\n  },\n  lotteriesData: null,\n  userLotteryData: {\n    account: '',\n    totalCake: '',\n    totalTickets: '',\n    rounds: []\n  }\n};\nexport const fetchCurrentLottery = createAsyncThunk('lottery/fetchCurrentLottery', async _ref => {\n  let {\n    currentLotteryId\n  } = _ref;\n  const lotteryInfo = await fetchLottery(currentLotteryId);\n  return lotteryInfo;\n});\nexport const fetchCurrentLotteryId = createAsyncThunk('lottery/fetchCurrentLotteryId', async () => {\n  const currentIdAndMaxBuy = await fetchCurrentLotteryIdAndMaxBuy();\n  return currentIdAndMaxBuy;\n});\nexport const fetchUserTicketsAndLotteries = createAsyncThunk('lottery/fetchUserTicketsAndLotteries', async _ref2 => {\n  var _userLotteriesRes$rou;\n  let {\n    account,\n    currentLotteryId\n  } = _ref2;\n  const userLotteriesRes = await getUserLotteryData(account, currentLotteryId);\n  const userParticipationInCurrentRound = (_userLotteriesRes$rou = userLotteriesRes.rounds) === null || _userLotteriesRes$rou === void 0 ? void 0 : _userLotteriesRes$rou.find(round => round.lotteryId === currentLotteryId);\n  const userTickets = userParticipationInCurrentRound === null || userParticipationInCurrentRound === void 0 ? void 0 : userParticipationInCurrentRound.tickets;\n\n  // User has not bought tickets for the current lottery, or there has been an error\n  if (!userTickets || userTickets.length === 0) {\n    return {\n      userTickets: null,\n      userLotteries: userLotteriesRes\n    };\n  }\n  return {\n    userTickets,\n    userLotteries: userLotteriesRes\n  };\n});\nexport const fetchPublicLotteries = createAsyncThunk('lottery/fetchPublicLotteries', async _ref3 => {\n  let {\n    currentLotteryId\n  } = _ref3;\n  const lotteries = await getLotteriesData(currentLotteryId);\n  return lotteries;\n});\nexport const fetchUserLotteries = createAsyncThunk('lottery/fetchUserLotteries', async _ref4 => {\n  let {\n    account,\n    currentLotteryId\n  } = _ref4;\n  const userLotteries = await getUserLotteryData(account, currentLotteryId);\n  return userLotteries;\n});\nexport const setLotteryIsTransitioning = createAsyncThunk(`lottery/setIsTransitioning`, async _ref5 => {\n  let {\n    isTransitioning\n  } = _ref5;\n  return {\n    isTransitioning\n  };\n});\nexport const LotterySlice = createSlice({\n  name: 'Lottery',\n  initialState,\n  reducers: {\n    setLotteryPublicData: (state, action) => {\n      state = action.payload;\n    }\n  },\n  extraReducers: builder => {\n    builder.addCase(fetchCurrentLottery.fulfilled, (state, action) => {\n      state.currentRound = {\n        ...state.currentRound,\n        ...action.payload\n      };\n    });\n    builder.addCase(fetchCurrentLotteryId.fulfilled, (state, action) => {\n      state.currentLotteryId = action.payload.currentLotteryId;\n      state.maxNumberTicketsPerBuyOrClaim = action.payload.maxNumberTicketsPerBuyOrClaim;\n    });\n    builder.addCase(fetchUserTicketsAndLotteries.fulfilled, (state, action) => {\n      state.currentRound.userTickets.isLoading = false;\n      state.currentRound.userTickets.tickets = action.payload.userTickets;\n      state.userLotteryData = action.payload.userLotteries;\n    });\n    builder.addCase(fetchPublicLotteries.fulfilled, (state, action) => {\n      state.lotteriesData = action.payload;\n    });\n    builder.addCase(fetchUserLotteries.fulfilled, (state, action) => {\n      state.userLotteryData = action.payload;\n    });\n    builder.addCase(setLotteryIsTransitioning.fulfilled, (state, action) => {\n      state.isTransitioning = action.payload.isTransitioning;\n    });\n  }\n});\n\n// Actions\nexport const {\n  setLotteryPublicData\n} = LotterySlice.actions;\nexport default LotterySlice.reducer;","map":{"version":3,"names":["createAsyncThunk","createSlice","LotteryStatus","fetchLottery","fetchCurrentLotteryIdAndMaxBuy","getLotteriesData","getUserLotteryData","initialState","currentLotteryId","isTransitioning","maxNumberTicketsPerBuyOrClaim","currentRound","isLoading","lotteryId","status","PENDING","startTime","endTime","priceTicketInCake","discountDivisor","treasuryFee","firstTicketId","lastTicketId","amountCollectedInCake","finalNumber","cakePerBracket","countWinnersPerBracket","rewardsBreakdown","userTickets","tickets","lotteriesData","userLotteryData","account","totalCake","totalTickets","rounds","fetchCurrentLottery","lotteryInfo","fetchCurrentLotteryId","currentIdAndMaxBuy","fetchUserTicketsAndLotteries","userLotteriesRes","userParticipationInCurrentRound","find","round","length","userLotteries","fetchPublicLotteries","lotteries","fetchUserLotteries","setLotteryIsTransitioning","LotterySlice","name","reducers","setLotteryPublicData","state","action","payload","extraReducers","builder","addCase","fulfilled","actions","reducer"],"sources":["/Users/namratapatel/upwork/SmartFinance-OmniDex/src/state/lottery/index.ts"],"sourcesContent":["/* eslint-disable no-param-reassign */\nimport { createAsyncThunk, createSlice, PayloadAction } from '@reduxjs/toolkit'\nimport { LotteryTicket, LotteryStatus } from 'config/constants/types'\nimport { LotteryState, LotteryRoundGraphEntity, LotteryUserGraphEntity, LotteryResponse } from 'state/types'\nimport { fetchLottery, fetchCurrentLotteryIdAndMaxBuy } from './helpers'\nimport getLotteriesData from './getLotteriesData'\nimport getUserLotteryData from './getUserLotteryData'\n\ninterface PublicLotteryData {\n  currentLotteryId: string\n  maxNumberTicketsPerBuyOrClaim: string\n}\n\nconst initialState: LotteryState = {\n  currentLotteryId: null,\n  isTransitioning: false,\n  maxNumberTicketsPerBuyOrClaim: null,\n  currentRound: {\n    isLoading: true,\n    lotteryId: null,\n    status: LotteryStatus.PENDING,\n    startTime: '',\n    endTime: '',\n    priceTicketInCake: '',\n    discountDivisor: '',\n    treasuryFee: '',\n    firstTicketId: '',\n    lastTicketId: '',\n    amountCollectedInCake: '',\n    finalNumber: null,\n    cakePerBracket: [],\n    countWinnersPerBracket: [],\n    rewardsBreakdown: [],\n    userTickets: {\n      isLoading: true,\n      tickets: [],\n    },\n  },\n  lotteriesData: null,\n  userLotteryData: { account: '', totalCake: '', totalTickets: '', rounds: [] },\n}\n\nexport const fetchCurrentLottery = createAsyncThunk<LotteryResponse, { currentLotteryId: string }>(\n  'lottery/fetchCurrentLottery',\n  async ({ currentLotteryId }) => {\n    const lotteryInfo = await fetchLottery(currentLotteryId)\n    return lotteryInfo\n  },\n)\n\nexport const fetchCurrentLotteryId = createAsyncThunk<PublicLotteryData>('lottery/fetchCurrentLotteryId', async () => {\n  const currentIdAndMaxBuy = await fetchCurrentLotteryIdAndMaxBuy()\n  return currentIdAndMaxBuy\n})\n\nexport const fetchUserTicketsAndLotteries = createAsyncThunk<\n  { userTickets: LotteryTicket[]; userLotteries: LotteryUserGraphEntity },\n  { account: string; currentLotteryId: string }\n>('lottery/fetchUserTicketsAndLotteries', async ({ account, currentLotteryId }) => {\n  const userLotteriesRes = await getUserLotteryData(account, currentLotteryId)\n  const userParticipationInCurrentRound = userLotteriesRes.rounds?.find((round) => round.lotteryId === currentLotteryId)\n  const userTickets = userParticipationInCurrentRound?.tickets\n\n  // User has not bought tickets for the current lottery, or there has been an error\n  if (!userTickets || userTickets.length === 0) {\n    return { userTickets: null, userLotteries: userLotteriesRes }\n  }\n\n  return { userTickets, userLotteries: userLotteriesRes }\n})\n\nexport const fetchPublicLotteries = createAsyncThunk<LotteryRoundGraphEntity[], { currentLotteryId: string }>(\n  'lottery/fetchPublicLotteries',\n  async ({ currentLotteryId }) => {\n    const lotteries = await getLotteriesData(currentLotteryId)\n    return lotteries\n  },\n)\n\nexport const fetchUserLotteries = createAsyncThunk<\n  LotteryUserGraphEntity,\n  { account: string; currentLotteryId: string }\n>('lottery/fetchUserLotteries', async ({ account, currentLotteryId }) => {\n  const userLotteries = await getUserLotteryData(account, currentLotteryId)\n  return userLotteries\n})\n\nexport const setLotteryIsTransitioning = createAsyncThunk<{ isTransitioning: boolean }, { isTransitioning: boolean }>(\n  `lottery/setIsTransitioning`,\n  async ({ isTransitioning }) => {\n    return { isTransitioning }\n  },\n)\n\nexport const LotterySlice = createSlice({\n  name: 'Lottery',\n  initialState,\n  reducers: {\n    setLotteryPublicData: (state, action) => {\n      state = action.payload\n    },\n  },\n  extraReducers: (builder) => {\n    builder.addCase(fetchCurrentLottery.fulfilled, (state, action: PayloadAction<LotteryResponse>) => {\n      state.currentRound = { ...state.currentRound, ...action.payload }\n    })\n    builder.addCase(fetchCurrentLotteryId.fulfilled, (state, action: PayloadAction<PublicLotteryData>) => {\n      state.currentLotteryId = action.payload.currentLotteryId\n      state.maxNumberTicketsPerBuyOrClaim = action.payload.maxNumberTicketsPerBuyOrClaim\n    })\n    builder.addCase(\n      fetchUserTicketsAndLotteries.fulfilled,\n      (state, action: PayloadAction<{ userTickets: LotteryTicket[]; userLotteries: LotteryUserGraphEntity }>) => {\n        state.currentRound.userTickets.isLoading = false\n        state.currentRound.userTickets.tickets = action.payload.userTickets\n        state.userLotteryData = action.payload.userLotteries\n      },\n    )\n    builder.addCase(fetchPublicLotteries.fulfilled, (state, action: PayloadAction<LotteryRoundGraphEntity[]>) => {\n      state.lotteriesData = action.payload\n    })\n    builder.addCase(fetchUserLotteries.fulfilled, (state, action: PayloadAction<LotteryUserGraphEntity>) => {\n      state.userLotteryData = action.payload\n    })\n    builder.addCase(\n      setLotteryIsTransitioning.fulfilled,\n      (state, action: PayloadAction<{ isTransitioning: boolean }>) => {\n        state.isTransitioning = action.payload.isTransitioning\n      },\n    )\n  },\n})\n\n// Actions\nexport const { setLotteryPublicData } = LotterySlice.actions\n\nexport default LotterySlice.reducer\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
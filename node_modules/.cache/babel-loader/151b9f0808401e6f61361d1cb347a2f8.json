{"ast":null,"code":"import _objectSpread from\"/Users/namratapatel/upwork/SmartFinance-OmniDex/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{createAsyncThunk,createSlice}from'@reduxjs/toolkit';import{merge}from'lodash';import{ProposalState,VotingStateLoadingStatus}from'state/types';import{getAllVotes,getProposal,getProposals,getVoteVerificationStatuses}from'./helpers';const initialState={proposalLoadingStatus:VotingStateLoadingStatus.INITIAL,proposals:{},voteLoadingStatus:VotingStateLoadingStatus.INITIAL,votes:{}};// Thunks\nexport const fetchProposals=createAsyncThunk('voting/fetchProposals',async _ref=>{let{first,skip=0,state=ProposalState.ACTIVE}=_ref;const response=await getProposals(first,skip,state);return response;});export const fetchProposal=createAsyncThunk('voting/fetchProposal',async proposalId=>{const response=await getProposal(proposalId);return response;});export const fetchVotes=createAsyncThunk('voting/fetchVotes',async _ref2=>{let{proposalId,block}=_ref2;const response=await getAllVotes(proposalId,block);return{votes:response,proposalId};});export const verifyVotes=createAsyncThunk('voting/verifyVotes',async(_ref3,_ref4)=>{let{proposalId,snapshot}=_ref3;let{getState}=_ref4;const state=getState();const proposalVotes=state.voting.votes[proposalId];const response=await getVoteVerificationStatuses(proposalVotes,Number(snapshot));return{results:response,proposalId};});export const votingSlice=createSlice({name:'voting',initialState,reducers:{},extraReducers:builder=>{// Verify Votes\nbuilder.addCase(verifyVotes.fulfilled,(state,action)=>{const{proposalId,results}=action.payload;if(state.votes[proposalId]){state.votes[proposalId]=state.votes[proposalId].map(vote=>{return _objectSpread(_objectSpread({},vote),{},{_inValid:results[vote.id]===false});});}});// Fetch Proposals\nbuilder.addCase(fetchProposals.pending,state=>{state.proposalLoadingStatus=VotingStateLoadingStatus.LOADING;});builder.addCase(fetchProposals.fulfilled,(state,action)=>{const proposals=action.payload.reduce((accum,proposal)=>{return _objectSpread(_objectSpread({},accum),{},{[proposal.id]:proposal});},{});state.proposals=merge({},state.proposals,proposals);state.proposalLoadingStatus=VotingStateLoadingStatus.IDLE;});// Fetch Proposal\nbuilder.addCase(fetchProposal.pending,state=>{state.proposalLoadingStatus=VotingStateLoadingStatus.LOADING;});builder.addCase(fetchProposal.fulfilled,(state,action)=>{state.proposals[action.payload.id]=action.payload;state.proposalLoadingStatus=VotingStateLoadingStatus.IDLE;});// Fetch Votes\nbuilder.addCase(fetchVotes.pending,state=>{state.voteLoadingStatus=VotingStateLoadingStatus.LOADING;});builder.addCase(fetchVotes.fulfilled,(state,action)=>{const{votes,proposalId}=action.payload;state.votes=_objectSpread(_objectSpread({},state.votes),{},{[proposalId]:votes});state.voteLoadingStatus=VotingStateLoadingStatus.IDLE;});}});export default votingSlice.reducer;","map":{"version":3,"names":["createAsyncThunk","createSlice","merge","ProposalState","VotingStateLoadingStatus","getAllVotes","getProposal","getProposals","getVoteVerificationStatuses","initialState","proposalLoadingStatus","INITIAL","proposals","voteLoadingStatus","votes","fetchProposals","_ref","first","skip","state","ACTIVE","response","fetchProposal","proposalId","fetchVotes","_ref2","block","verifyVotes","_ref3","_ref4","snapshot","getState","proposalVotes","voting","Number","results","votingSlice","name","reducers","extraReducers","builder","addCase","fulfilled","action","payload","map","vote","_objectSpread","_inValid","id","pending","LOADING","reduce","accum","proposal","IDLE","reducer"],"sources":["/Users/namratapatel/upwork/SmartFinance-OmniDex/src/state/voting/index.tsx"],"sourcesContent":["import { createAsyncThunk, createSlice } from '@reduxjs/toolkit'\nimport { merge } from 'lodash'\nimport { Proposal, ProposalState, VotingStateLoadingStatus, VotingState, Vote, State } from 'state/types'\nimport { getAllVotes, getProposal, getProposals, getVoteVerificationStatuses } from './helpers'\n\nconst initialState: VotingState = {\n  proposalLoadingStatus: VotingStateLoadingStatus.INITIAL,\n  proposals: {},\n  voteLoadingStatus: VotingStateLoadingStatus.INITIAL,\n  votes: {},\n}\n\n// Thunks\nexport const fetchProposals = createAsyncThunk<Proposal[], { first?: number; skip?: number; state?: ProposalState }>(\n  'voting/fetchProposals',\n  async ({ first, skip = 0, state = ProposalState.ACTIVE }) => {\n    const response = await getProposals(first, skip, state)\n    return response\n  },\n)\n\nexport const fetchProposal = createAsyncThunk<Proposal, string>('voting/fetchProposal', async (proposalId) => {\n  const response = await getProposal(proposalId)\n  return response\n})\n\nexport const fetchVotes = createAsyncThunk<\n  { votes: Vote[]; proposalId: string },\n  { proposalId: string; block?: number }\n>('voting/fetchVotes', async ({ proposalId, block }) => {\n  const response = await getAllVotes(proposalId, block)\n  return { votes: response, proposalId }\n})\n\nexport const verifyVotes = createAsyncThunk<\n  { results: { [key: string]: boolean }; proposalId: string },\n  { proposalId: string; snapshot?: string },\n  { state: State }\n>('voting/verifyVotes', async ({ proposalId, snapshot }, { getState }) => {\n  const state = getState()\n  const proposalVotes = state.voting.votes[proposalId]\n  const response = await getVoteVerificationStatuses(proposalVotes, Number(snapshot))\n  return { results: response, proposalId }\n})\n\nexport const votingSlice = createSlice({\n  name: 'voting',\n  initialState,\n  reducers: {},\n  extraReducers: (builder) => {\n    // Verify Votes\n    builder.addCase(verifyVotes.fulfilled, (state, action) => {\n      const { proposalId, results } = action.payload\n\n      if (state.votes[proposalId]) {\n        state.votes[proposalId] = state.votes[proposalId].map((vote) => {\n          return {\n            ...vote,\n            _inValid: results[vote.id] === false,\n          }\n        })\n      }\n    })\n\n    // Fetch Proposals\n    builder.addCase(fetchProposals.pending, (state) => {\n      state.proposalLoadingStatus = VotingStateLoadingStatus.LOADING\n    })\n    builder.addCase(fetchProposals.fulfilled, (state, action) => {\n      const proposals = action.payload.reduce((accum, proposal) => {\n        return {\n          ...accum,\n          [proposal.id]: proposal,\n        }\n      }, {})\n\n      state.proposals = merge({}, state.proposals, proposals)\n      state.proposalLoadingStatus = VotingStateLoadingStatus.IDLE\n    })\n\n    // Fetch Proposal\n    builder.addCase(fetchProposal.pending, (state) => {\n      state.proposalLoadingStatus = VotingStateLoadingStatus.LOADING\n    })\n    builder.addCase(fetchProposal.fulfilled, (state, action) => {\n      state.proposals[action.payload.id] = action.payload\n      state.proposalLoadingStatus = VotingStateLoadingStatus.IDLE\n    })\n\n    // Fetch Votes\n    builder.addCase(fetchVotes.pending, (state) => {\n      state.voteLoadingStatus = VotingStateLoadingStatus.LOADING\n    })\n    builder.addCase(fetchVotes.fulfilled, (state, action) => {\n      const { votes, proposalId } = action.payload\n\n      state.votes = {\n        ...state.votes,\n        [proposalId]: votes,\n      }\n      state.voteLoadingStatus = VotingStateLoadingStatus.IDLE\n    })\n  },\n})\n\nexport default votingSlice.reducer\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}